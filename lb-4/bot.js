import { Telegraf } from "telegraf";
import dotenv from "dotenv";
import { trackUser, trackInteraction, loadStats } from "./stats.js";

dotenv.config();

const bot = new Telegraf(process.env.BOT_TOKEN);

bot.start((ctx) => {
  trackUser(ctx);

  ctx.reply(
    "ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚! Ğ¯ Ğ±Ğ¾Ñ‚-Ğ¿Ğ¾Ğ¼Ñ–Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ»Ñ Ğ°Ğ±Ñ–Ñ‚ÑƒÑ€Ñ–Ñ”Ğ½Ñ‚Ñ–Ğ², ÑĞºÑ– Ñ…Ğ¾Ñ‡ÑƒÑ‚ÑŒ Ğ²ÑÑ‚ÑƒĞ¿Ğ¸Ñ‚Ğ¸ Ğ½Ğ° ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ½Ñƒ Ñ–Ğ½Ğ¶ĞµĞ½ĞµÑ€Ñ–Ñ Ğ² Ğ¥ĞĞ£Ğ Ğ•.\nĞ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ, ÑĞºĞµ Ğ²Ğ°Ñ Ñ†Ñ–ĞºĞ°Ğ²Ğ¸Ñ‚ÑŒ:",
    {
      reply_markup: {
        keyboard: [
          ["ğŸ“š Ğ¯ĞºÑ– Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ñ–?", "ğŸ“Š Ğ¯ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ…Ñ–Ğ´Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ»?"],
          ["ğŸ“… Ğ”ĞµĞ´Ğ»Ğ°Ğ¹Ğ½Ğ¸ Ğ¿Ğ¾Ğ´Ğ°Ñ‡Ñ– Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ–Ğ²", "ğŸ“ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ¹Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ñ— ĞºĞ¾Ğ¼Ñ–ÑÑ–Ñ—"],
        ],
        resize_keyboard: true,
      },
    }
  );
});

bot.hears("ğŸ“š Ğ¯ĞºÑ– Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ñ–?", (ctx) => {
  trackInteraction("subjects");
  ctx.reply(
    "âœ… Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ° Ğ¼Ğ¾Ğ²Ğ°\nâœ… ĞœĞ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ°\nâœ… ĞĞ´Ğ¸Ğ½ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ Ğ½Ğ° Ğ²Ğ¸Ğ±Ñ–Ñ€: Ğ†Ğ½Ğ¾Ğ·ĞµĞ¼Ğ½Ğ° Ğ¼Ğ¾Ğ²Ğ°, Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ£ĞºÑ€Ğ°Ñ—Ğ½Ğ¸ Ğ°Ğ±Ğ¾ Ğ¤Ñ–Ğ·Ğ¸ĞºĞ°"
  );
});

bot.hears("ğŸ“Š Ğ¯ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ…Ñ–Ğ´Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ»?", (ctx) => {
  trackInteraction("score");
  ctx.reply(
    "ğŸ“Š ĞŸÑ€Ğ¾Ñ…Ñ–Ğ´Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ» Ğ½Ğ° Ğ±ÑĞ´Ğ¶ĞµÑ‚ Ñƒ 2024 Ñ€Ğ¾Ñ†Ñ– â€” Ğ²Ñ–Ğ´ 170+. Ğ¢Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ» Ğ·Ğ°Ğ»ĞµĞ¶Ğ¸Ñ‚ÑŒ Ğ²Ñ–Ğ´ ĞºĞ¾Ğ½ĞºÑƒÑ€ÑÑƒ."
  );
});

bot.hears("ğŸ“… Ğ”ĞµĞ´Ğ»Ğ°Ğ¹Ğ½Ğ¸ Ğ¿Ğ¾Ğ´Ğ°Ñ‡Ñ– Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ–Ğ²", (ctx) => {
  trackInteraction("deadlines");
  ctx.reply(
    "ğŸ—“ï¸ Ğ’Ğ°Ğ¶Ğ»Ğ¸Ğ²Ñ– Ğ´Ğ°Ñ‚Ğ¸:\n- ĞŸĞ¾Ğ´Ğ°Ğ½Ğ½Ñ Ğ·Ğ°ÑĞ²: 1â€“15 Ğ»Ğ¸Ğ¿Ğ½Ñ 2025\n- Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ¾Ğ²Ñ– ÑĞ¿Ğ¸ÑĞºĞ¸: Ğ´Ğ¾ 20 Ğ»Ğ¸Ğ¿Ğ½Ñ\n- Ğ—Ğ°Ñ€Ğ°Ñ…ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ½Ğ° Ğ±ÑĞ´Ğ¶ĞµÑ‚: Ğ´Ğ¾ 25 Ğ»Ğ¸Ğ¿Ğ½Ñ"
  );
});

bot.hears("ğŸ“ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ¹Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ñ— ĞºĞ¾Ğ¼Ñ–ÑÑ–Ñ—", (ctx) => {
  trackInteraction("contacts");
  ctx.reply(
    "ğŸŒ Ğ¡Ğ°Ğ¹Ñ‚: https://software.nure.ua/\nğŸ“ Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½: +38 (057) 702-13-53\nâœ‰ï¸ Email: pi@nure.ua"
  );
});

bot.command("stats", (ctx) => {
  const stats = loadStats();
  const isAdmin = ctx.chat.id == process.env.ADMIN_ID;

  if (!isAdmin) return ctx.reply("â›” Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ»Ğ¸ÑˆĞµ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°");

  ctx.reply(
    `ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ±Ğ¾Ñ‚Ğ°:\n` +
      `ğŸ‘¥ Ğ£Ğ½Ñ–ĞºĞ°Ğ»ÑŒĞ½Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–: ${stats.users.length}\n` +
      `ğŸ“š ĞŸÑ€ĞµĞ´Ğ¼ĞµÑ‚Ğ¸: ${stats.interactions.subjects}\n` +
      `ğŸ“Š Ğ‘Ğ°Ğ»: ${stats.interactions.score}\n` +
      `ğŸ“… Ğ”ĞµĞ´Ğ»Ğ°Ğ¹Ğ½Ğ¸: ${stats.interactions.deadlines}\n` +
      `ğŸ“ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¸: ${stats.interactions.contacts}`
  );
});

bot.launch();
console.log("Ğ‘Ğ¾Ñ‚ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾! ğŸš€");
